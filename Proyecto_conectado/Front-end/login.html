<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Congreso Universitario - Iniciar SesiÃ³n</title>
    <link rel="stylesheet" href="../CSS/style.css">
</head>
<body>
    <!-- Pantalla de carga -->
    <div id="pantalla-carga">
        <div class="collage">
            <img src="https://www.uaa.mx/portal/wp-content/uploads/2025/07/redes-LQSTJ_pweb-scaled.jpg" alt="Imagen 1">
            <img src="https://www.uaa.mx/portal/wp-content/uploads/2024/07/Banner_MKT-04.jpg" alt="Imagen 2">
            <img src="https://www.uaa.mx/portal/wp-content/uploads/2024/07/Encuentro-MKT-30-Aniv-IMG_8696-1024x729.jpg" alt="Imagen 3">
            <img src="https://www.uaa.mx/portal/wp-content/uploads/2024/07/Encuentro-MKT-30-Aniv-IMG_8465-300x200.jpg" alt="Imagen 4">
            <img src="https://www.uaa.mx/portal/wp-content/uploads/2024/07/Expo-MKT-Credito-Facebook-Mercadotecnia-UAA_2-300x169.jpg" alt="Imagen 5">
            <img src="https://www.uaa.mx/portal/wp-content/uploads/2025/03/GracielaSalazar.jpg" alt="Imagen 6">
        </div>
    </div>
  
    <header>
        <h1>Congreso Universitario</h1>
    </header>

    <main class="login-container">
        <h2>Iniciar SesiÃ³n</h2>
        
        <!-- Ayuda de credenciales -->
        <div style="background-color: #e3f2fd; padding: 12px; border-radius: 6px; margin-bottom: 20px; font-size: 13px; border-left: 4px solid #2196f3;">
            <strong>ðŸ’¡ Credenciales de prueba:</strong><br>
            <strong>Usuario:</strong> A12345678 / Test123456<br>
            <strong>Admin:</strong> admin@congreso.com / admin123
        </div>
        
        <form id="login-form">
            <div class="form-group">
                <label for="university_id">ID Universitario / Email:</label>
                <input type="text" id="university_id" name="university_id" placeholder="MatrÃ­cula o Email" required>
            </div>
            <div class="form-group">
                <label for="password">ContraseÃ±a:</label>
                <input type="password" id="password" name="password" placeholder="ContraseÃ±a" required>
            </div>
            <button type="submit" id="submit-btn">Ingresar</button>
            <div class="error" id="error-msg" style="display:none; color:#d32f2f; background-color:#ffebee; padding:10px; border-radius:4px; margin-top:10px;"></div>
            <div class="success" id="success-msg" style="display:none; color:#2e7d32; background-color:#e8f5e9; padding:10px; border-radius:4px; margin-top:10px;"></div>
            
            <div class="registro-link" style="margin-top: 15px; font-size: 14px; text-align: center;">
                Â¿No tienes cuenta? <a href="registro_usuario.html">RegÃ­strate aquÃ­</a>
            </div>
            <div class="forgot-password-link" style="margin-top: 10px; font-size: 14px; text-align: center;">
                <a href="recuperar_pass.html">Â¿Olvidaste tu contraseÃ±a?</a>
            </div>
        </form>
        <p>Â¿Eres Administrador? <a href="login_admin.html">Ingresa aquÃ­</a></p>
    </main>

    <footer>
        <p>&copy; 2025 Universidad Autonoma de Aguascalientes. Todos los derechos reservados.</p>
        <p style="margin-top: 5px; font-size: 12px;">
            <a href="terminos_legales.html" target="_blank" style="color: #fff; text-decoration: underline;">TÃ©rminos y Condiciones</a>
        </p>
    </footer>

    <script>
        document.getElementById('login-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const errorDiv = document.getElementById('error-msg');
            const successDiv = document.getElementById('success-msg');
            const submitBtn = document.getElementById('submit-btn');
            
            errorDiv.style.display = 'none';
            successDiv.style.display = 'none';
            
            submitBtn.disabled = true;
            submitBtn.textContent = 'Procesando...';
            
            try {
                const response = await fetch('/php/login.php', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    successDiv.textContent = 'Â¡Login exitoso! Redirigiendo...';
                    successDiv.style.display = 'block';
                    
                    // Guardar datos de sesiÃ³n
                    if (data.userData) {
                        sessionStorage.setItem('userData', JSON.stringify(data.userData));
                        sessionStorage.setItem('sessionToken', data.token);
                    }
                    
                    // Redirigir segÃºn el tipo de usuario
                    setTimeout(() => {
                        if (data.redirectUrl) {
                            window.location.href = data.redirectUrl;
                        } else if (data.userData && data.userData.tipo === 'admin') {
                            window.location.href = '/Front-end/admin_dashboard.html';
                        } else {
                            window.location.href = '/Front-end/dashboard_alumno.html';
                        }
                    }, 500);
                } else {
                    errorDiv.textContent = data.message;
                    errorDiv.style.display = 'block';
                }
            } catch (error) {
                errorDiv.textContent = 'Error de conexiÃ³n: ' + error.message;
                errorDiv.style.display = 'block';
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Ingresar';
            }
        });
    </script>
    
    <script>
        // Script de la pantalla de carga
        window.addEventListener("load", function () {
            setTimeout(function () {
                const pantallaCarga = document.getElementById("pantalla-carga");
                if (pantallaCarga) {
                    pantallaCarga.style.display = "none";
                }
            }, 3500);
        });
    </script>
</body>
</html>
