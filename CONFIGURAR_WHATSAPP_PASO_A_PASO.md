# üì± Gu√≠a Paso a Paso: Configurar WhatsApp Business API con Twilio

## üéØ Objetivo
Enviar c√≥digos de verificaci√≥n por **WhatsApp** (no SMS) usando tu n√∫mero: **+52 449 210 6893**

---

## ‚è±Ô∏è Tiempo estimado: 3-5 d√≠as (por aprobaciones)

**Importante:** WhatsApp requiere aprobaciones que pueden tomar tiempo. ¬°Paciencia! üòä

---

## üìã FASE 1: Preparaci√≥n (15 minutos)

### Requisitos que necesitas:
- [ ] Cuenta de Twilio (gratis)
- [ ] N√∫mero de tel√©fono: **+52 449 210 6893**
- [ ] Correo electr√≥nico de negocio
- [ ] Cuenta de Facebook Business (te ayudo a crearla)

### Paso 1.1: Crear cuenta en Twilio

1. **Ve a:** https://www.twilio.com/try-twilio
2. **Reg√≠strate con:**
   - Tu email
   - Contrase√±a segura
3. **Verifica tu email**
4. **Verifica tu n√∫mero de tel√©fono** (+52 449 210 6893)
5. **Recibir√°s $15 USD en cr√©ditos gratuitos**

### Paso 1.2: Acceder al Dashboard

1. **Ve a:** https://console.twilio.com/
2. **Guarda estas credenciales** (las necesitar√°s despu√©s):
   ```
   Account SID: ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
   Auth Token: (haz clic en "Show" para verlo)
   ```
3. **An√≥talas en un lugar seguro**

---

## üè¢ FASE 2: Configurar Facebook Business Manager (30 minutos)

WhatsApp Business API requiere una cuenta de Facebook Business Manager.

### Paso 2.1: Crear Facebook Business Manager

1. **Ve a:** https://business.facebook.com/
2. **Haz clic en "Create account"**
3. **Completa la informaci√≥n:**
   - Nombre del negocio: "Congreso de Mercadotecnia UAA"
   - Tu nombre
   - Email de negocio
4. **Verifica tu negocio:**
   - Sube documento oficial (puede ser credencial, comprobante)
   - O conecta p√°gina de Facebook del negocio

### Paso 2.2: Crear cuenta de WhatsApp Business

1. En Facebook Business Manager, ve a:
   - **Business Settings** ‚Üí **Accounts** ‚Üí **WhatsApp Accounts**
2. Haz clic en **"Add"** ‚Üí **"Create a new WhatsApp Business Account"**
3. **Informaci√≥n requerida:**
   - Nombre para mostrar: "Congreso MKT UAA"
   - Categor√≠a: "Education" o "Event Planning"
   - Descripci√≥n: "Sistema de verificaci√≥n para Congreso de Mercadotecnia"

---

## üìû FASE 3: Conectar WhatsApp con Twilio (20 minutos)

### Paso 3.1: Ir al WhatsApp Sender en Twilio

1. **Ve a:** https://console.twilio.com/us1/develop/sms/senders/whatsapp-senders
2. **Haz clic en:** "Create new WhatsApp Sender"
3. **Selecciona:** "Use my own WhatsApp Business Account"

### Paso 3.2: Conectar tu cuenta de Facebook

1. **Haz clic en:** "Connect to Facebook Business Manager"
2. **Inicia sesi√≥n** con tu cuenta de Facebook
3. **Autoriza a Twilio** a acceder a tu Business Manager
4. **Selecciona** tu WhatsApp Business Account creado en Fase 2

### Paso 3.3: Registrar tu n√∫mero de tel√©fono

**IMPORTANTE:** Este es el paso cr√≠tico para usar tu n√∫mero **+52 449 210 6893**

1. **En Twilio, selecciona:** "Add phone number to WhatsApp Business Account"
2. **Ingresa tu n√∫mero:** +52 449 210 6893
3. **M√©todo de verificaci√≥n:** 
   - Opci√≥n A: **SMS** (recibir√°s un c√≥digo por SMS)
   - Opci√≥n B: **Llamada de voz** (recibir√°s una llamada con el c√≥digo)
4. **Ingresa el c√≥digo de verificaci√≥n** que recibas
5. **Espera la confirmaci√≥n:** "Phone number verified successfully"

### Paso 3.4: Configurar perfil de WhatsApp Business

1. **Completa el perfil:**
   - Nombre: "Congreso MKT UAA"
   - Foto de perfil: Logo del congreso
   - Descripci√≥n: "Verificaci√≥n para Congreso de Mercadotecnia"
   - Categor√≠a: "Education"
   - Direcci√≥n: Universidad Aut√≥noma de Aguascalientes
   - Email: (tu email de contacto)
   - Sitio web: (si aplica)

---

## üìù FASE 4: Crear Plantillas de Mensajes (30 minutos + 24-48h aprobaci√≥n)

WhatsApp requiere que todos los mensajes sean pre-aprobados mediante plantillas.

### Paso 4.1: Crear plantilla de c√≥digo de verificaci√≥n

1. **Ve a:** https://console.twilio.com/us1/develop/sms/content-editor
2. **Haz clic en:** "Create new Content Template"
3. **Configuraci√≥n de la plantilla:**

```
Template Name: codigo_verificacion
Language: Spanish (es_MX)
Category: AUTHENTICATION

Header: None

Body:
Hola {{1}},

Tu c√≥digo de verificaci√≥n para el Congreso de Mercadotecnia es:

üîê {{2}}

Este c√≥digo expira en 15 minutos.
No compartas este c√≥digo con nadie.

Si no solicitaste este c√≥digo, ignora este mensaje.

Footer:
Congreso MKT - UAA

Buttons: None
```

4. **Variables explicadas:**
   - `{{1}}` = Nombre del usuario
   - `{{2}}` = C√≥digo de 6 d√≠gitos

### Paso 4.2: Enviar para aprobaci√≥n

1. **Haz clic en:** "Submit for approval"
2. **Espera:** 24-48 horas (a veces m√°s r√°pido)
3. **Recibir√°s email** cuando sea aprobado o rechazado

### ‚ö†Ô∏è Consejos para aprobaci√≥n r√°pida:
- ‚úÖ Usa lenguaje claro y profesional
- ‚úÖ No uses URLs acortadas
- ‚úÖ No prometas premios o sorteos
- ‚úÖ Indica claramente el prop√≥sito del mensaje
- ‚ùå Evita emojis excesivos
- ‚ùå No uses lenguaje marketing agresivo

---

## üíª FASE 5: Configurar el C√≥digo PHP (10 minutos)

Una vez que tu plantilla sea aprobada, necesitas actualizar el c√≥digo.

### Paso 5.1: Actualizar configuraci√≥n

Edita: `Proyecto_conectado/php/verificacion_config.php`

```php
<?php
// N√∫mero emisor (tu WhatsApp Business registrado)
define('TELEFONO_EMISOR', '+5244921068393'); // Ya est√° correcto

// CAMBIAR A false para usar WhatsApp real
define('SMS_MODE_DESARROLLO', false); // ‚ö†Ô∏è CAMBIAR DESPU√âS DE APROBACI√ìN

// Credenciales de Twilio (del dashboard)
define('TWILIO_ACCOUNT_SID', 'ACxxxxxxxxxxxxxxxx'); // ‚ö†Ô∏è Pega tu Account SID
define('TWILIO_AUTH_TOKEN', 'tu_auth_token_aqui'); // ‚ö†Ô∏è Pega tu Auth Token

// Configuraci√≥n espec√≠fica de WhatsApp
define('USE_WHATSAPP', true); // ‚ö†Ô∏è NUEVO: Activar WhatsApp en lugar de SMS
define('WHATSAPP_TEMPLATE_SID', 'HXxxxxxxxxxxxxxxxxxx'); // ‚ö†Ô∏è SID de tu plantilla aprobada
?>
```

### Paso 5.2: Actualizar servicio de SMS para WhatsApp

Voy a crear un nuevo archivo para manejar WhatsApp espec√≠ficamente.

---

## üß™ FASE 6: Testing con WhatsApp Sandbox (Mientras esperas aprobaci√≥n)

Puedes empezar a probar AHORA mismo con el Sandbox de Twilio:

### Paso 6.1: Activar Sandbox

1. **Ve a:** https://console.twilio.com/us1/develop/sms/try-it-out/whatsapp-learn
2. **Ver√°s un n√∫mero de WhatsApp de Twilio** (ej: +1 415 523 8886)
3. **Ver√°s un c√≥digo √∫nico** (ej: "join example-word")

### Paso 6.2: Unirte al Sandbox desde tu WhatsApp

1. **Abre WhatsApp** en tu tel√©fono
2. **Agrega el n√∫mero de Twilio** a tus contactos
3. **Env√≠a el mensaje que te indica** (ej: "join example-word")
4. **Recibir√°s confirmaci√≥n:** "You are now connected to the Twilio Sandbox"

### Paso 6.3: Configurar Sandbox en el c√≥digo

```php
// Para testing con Sandbox (temporal)
define('TELEFONO_EMISOR', '+14155238886'); // N√∫mero del Sandbox
define('USE_WHATSAPP_SANDBOX', true); // Solo para desarrollo
```

### Paso 6.4: Probar

1. Registra un usuario con TU n√∫mero (+52 449 210 6893)
2. Deber√≠as recibir el c√≥digo por WhatsApp
3. ‚úÖ Si funciona, tu configuraci√≥n es correcta

---

## üîÑ FASE 7: Migrar de Sandbox a Producci√≥n

Una vez que tu plantilla sea aprobada y tu n√∫mero verificado:

### Paso 7.1: Actualizar configuraci√≥n

```php
<?php
define('TELEFONO_EMISOR', '+5244921068393'); // Tu n√∫mero real
define('USE_WHATSAPP_SANDBOX', false); // Desactivar sandbox
define('USE_WHATSAPP', true); // Activar WhatsApp producci√≥n
define('SMS_MODE_DESARROLLO', false); // Desactivar modo desarrollo
define('WHATSAPP_TEMPLATE_SID', 'HXxxxxx'); // SID de plantilla aprobada
?>
```

### Paso 7.2: Reiniciar Docker

```powershell
docker compose restart
```

### Paso 7.3: Probar con usuario real

1. Registra un nuevo usuario
2. El c√≥digo debe llegar por WhatsApp
3. ‚úÖ ¬°Listo!

---

## üìä Checklist de Progreso

### Completar en orden:

- [ ] **D√≠a 1:** Crear cuenta Twilio
- [ ] **D√≠a 1:** Crear Facebook Business Manager
- [ ] **D√≠a 1:** Conectar WhatsApp con Twilio
- [ ] **D√≠a 1:** Verificar n√∫mero +52 449 210 6893
- [ ] **D√≠a 1:** Crear plantilla de mensaje
- [ ] **D√≠a 1:** Enviar plantilla para aprobaci√≥n
- [ ] **D√≠a 1:** Probar con Sandbox (opcional pero recomendado)
- [ ] **D√≠a 2-4:** Esperar aprobaci√≥n de plantilla ‚è≥
- [ ] **D√≠a 5:** Configurar c√≥digo PHP con plantilla aprobada
- [ ] **D√≠a 5:** Activar modo producci√≥n
- [ ] **D√≠a 5:** Probar con usuarios reales
- [ ] **D√≠a 5:** ‚úÖ ¬°Sistema funcionando con WhatsApp!

---

## üí∞ Costos

### Cr√©ditos gratuitos:
- **$15 USD** al crear cuenta (suficiente para ~1,500 mensajes)

### Costos despu√©s de cr√©ditos:
- **WhatsApp en M√©xico:** ~$0.005 USD por mensaje
- **Muy econ√≥mico:** 1,000 mensajes = ~$5 USD

---

## ‚ùì Preguntas Frecuentes

### ¬øPuedo usar mi n√∫mero personal de WhatsApp?
‚ùå No. Necesitas un n√∫mero dedicado para WhatsApp Business API.
Tu n√∫mero +52 449 210 6893 debe ser convertido a WhatsApp Business.
**Advertencia:** No podr√°s usar WhatsApp normal en ese n√∫mero despu√©s.

### ¬øPerder√© mis chats de WhatsApp?
‚úÖ Puedes hacer backup antes de convertir.
‚ö†Ô∏è Considera usar un n√∫mero dedicado solo para el sistema.

### ¬øPuedo usar otro n√∫mero?
‚úÖ S√≠, si prefieres no usar tu n√∫mero personal, puedes:
1. Comprar un n√∫mero nuevo en Twilio (~$1-2 USD/mes)
2. O usar un n√∫mero diferente que tengas disponible

### ¬øCu√°nto tarda la aprobaci√≥n de plantillas?
‚è±Ô∏è T√≠picamente 24-48 horas
üöÄ A veces m√°s r√°pido (2-6 horas)
‚è≥ Puede tardar hasta 7 d√≠as en casos excepcionales

### ¬øQu√© hago si rechazan mi plantilla?
1. Lee el motivo del rechazo en el email
2. Ajusta el texto seg√∫n las recomendaciones
3. Vuelve a enviar para aprobaci√≥n
4. Contacta soporte de Twilio si tienes dudas

---

## üÜò Soporte

### Si necesitas ayuda:

**Twilio Support:**
- Email: help@twilio.com
- Docs: https://www.twilio.com/docs/whatsapp
- Phone: Disponible en dashboard

**Meta/Facebook Support:**
- WhatsApp Business: https://business.whatsapp.com/support

**Yo (tu asistente):**
- Estoy aqu√≠ para ayudarte en cada paso üòä
- Solo dime en qu√© fase est√°s

---

## üéØ Pr√≥ximos Pasos AHORA MISMO

### 1. Crear cuenta Twilio (5 min)
üëâ https://www.twilio.com/try-twilio

### 2. Crear Facebook Business Manager (10 min)
üëâ https://business.facebook.com/

### 3. ¬øQuieres probar con Sandbox primero?
üëâ Te recomiendo esto para verificar que todo funciona

---

## üìû ¬øListo para empezar?

Dime en qu√© paso est√°s o si tienes alguna duda. Te voy a ayudar en todo el proceso.

**¬øYa tienes cuenta de Twilio?** ‚Üí Vamos a Fase 2
**¬øNecesitas crear cuenta?** ‚Üí Empecemos por Fase 1
**¬øPrefieres probar Sandbox primero?** ‚Üí Te gu√≠o paso a paso

¬°Vamos a configurar tu WhatsApp! üöÄ
