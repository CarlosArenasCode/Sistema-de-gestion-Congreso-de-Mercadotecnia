<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Admin - Congreso Universitario</title>
    <link rel="stylesheet" href="../CSS/style.css"> </head>
<body>
    <header>
         <div class="header-top">
            <div class="main-title">
                 <h1>Congreso Universitario</h1>
            </div>
            <section class="sponsor-logos-header">
                <img src="../Logos/UAA_LOGO.png" alt="Logo Universidad AutÃ³noma de Aguascalientes">
                <img src="../Logos/logo-ccea.png" alt="Logo CCEA">
                <img src="../Logos/MKT_LOGO.png" alt="Logo MKT">
            </section>
        </div>
        <nav id="main-navigation">
             <ul>
                <li><a href="admin_dashboard.html" class="nav-link active" id="nav-admin-dashboard">Panel Admin</a></li>
                <li><a href="admin_eventos.html" class="nav-link" id="nav-admin-eventos">Gestionar Eventos</a></li>
                <li><a href="admin_usuarios.html" class="nav-link" id="nav-admin-usuarios">Gestionar Usuarios</a></li>
                <li><a href="admin_scan_qr.html" class="nav-link" id="nav-admin-scan">Escanear QR</a></li>
                <li><a href="admin_asistencia.html" class="nav-link" id="nav-admin-asistencia">Ver Asistencia</a></li>
                <li><a href="admin_inscripciones.html" class="nav-link" id="nav-admin-inscripciones">Ver Inscripciones</a></li>
                <li><a href="admin_constancias.html" class="nav-link" id="nav-admin-constancias">Constancias Emitidas</a></li>
                <li><a href="admin_justificacion.html" class="nav-link" id="nav-admin-justificaciones">Gestionar Justificaciones</a></li>
                <li><a href="admin_personalizacion.html" class="nav-link" id="nav-admin-personalizacion">PersonalizaciÃ³n</a></li>
                <li class="user-menu">
                    <span>Bienvenido, [Nombre Admin]</span>
                    <a href="#" id="logout-btn" class="logout-button button">Cerrar SesiÃ³n</a>
                </li>
            </ul>
        </nav>
    </header>

    <main>
        <h2>Panel de AdministraciÃ³n</h2>
        <p>Bienvenido al panel de control del Congreso Universitario.</p>

        <section class="quick-stats content-box"> 
            <h3>EstadÃ­sticas en Tiempo Real ðŸ”´</h3>
            <div class="stats-container"> 
                <p><strong>Asistencias Registradas (Total):</strong> <span id="stat-total-attendance" data-stat="totalAttendance">0</span></p>
                <p><strong>Eventos Activos:</strong> <span id="stat-active-events" data-stat="activeEvents">0</span></p>
                <p><strong>Clientes Conectados:</strong> <span id="stat-connected-clients" data-stat="connectedClients">0</span></p>
                <p><strong>Ãšltima ActualizaciÃ³n:</strong> <span id="stat-last-update">--</span></p>
            </div>
            <div id="websocket-status" style="margin-top: 10px; padding: 8px; border-radius: 4px; background: #f8f9fa;">
                <small>ðŸ”Œ <span id="ws-status-text">Conectando a servidor...</span></small>
            </div>
        </section>

        <section class="admin-actions content-box">
             <h3>Acciones Comunes</h3>
             <div class="quick-links">
                <a href="admin_eventos.html" class="button">Gestionar Eventos</a>
                <a href="admin_usuarios.html" class="button">Gestionar Usuarios</a>
                <a href="admin_inscripciones.html" class="button">Ver Inscripciones</a>
                <a href="admin_constancias.html" class="button">Emitir Constancias</a>
                <a href="admin_justificacion.html" class="button">Gestionar Justificaciones</a>
                <a href="admin_personalizacion.html" class="button" style="background-color: #6f42c1; color: white;">ðŸŽ¨ Personalizar Sitio</a>
                <a href="admin_scan_qr.html" class="button secondary">Escanear QR</a>
                <a href="admin_asistencia.html" class="button secondary">Ver Reportes de Asistencia</a>
             </div>
        </section>

    </main>

    <footer>
        <p>&copy; 2025 Congreso Universitario. Todos los derechos reservados.</p>
    </footer>
    
    <!-- Socket.IO Client CDN -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    
    <!-- WebSocket Client -->
    <script src="../js/websocket-client.js"></script>
    
    <!-- Dashboard Scripts -->
    <script src="../js_admin/admin_dashboard.js"></script>

    <!-- WebSocket Integration -->
    <script>
        // Inicializar cliente WebSocket
        const ws = new AttendanceWebSocket({
            serverUrl: 'http://localhost:3001',
            debug: true
        });
        
        // Elementos del DOM
        const wsStatusText = document.getElementById('ws-status-text');
        const wsStatusContainer = document.getElementById('websocket-status');
        const lastUpdateEl = document.getElementById('stat-last-update');
        
        // Conectar al servidor
        ws.connect();
        
        // Manejar conexiÃ³n exitosa
        ws.on('connected', () => {
            ws.joinAdmin();
            wsStatusText.textContent = 'âœ… Conectado - Actualizaciones en tiempo real activas';
            wsStatusContainer.style.background = '#d4edda';
            wsStatusContainer.style.color = '#155724';
        });
        
        // Manejar desconexiÃ³n
        ws.on('disconnected', () => {
            wsStatusText.textContent = 'âš ï¸ Desconectado - Reintentando...';
            wsStatusContainer.style.background = '#fff3cd';
            wsStatusContainer.style.color = '#856404';
        });
        
        // Actualizar cuando se registra asistencia
        ws.on('attendance:admin:update', (data) => {
            console.log('ðŸ“Š ActualizaciÃ³n de asistencia:', data);
            
            // Actualizar estadÃ­sticas
            if (data.stats) {
                document.getElementById('stat-total-attendance').textContent = data.stats.totalAttendance;
                document.getElementById('stat-active-events').textContent = data.stats.activeEvents;
                document.getElementById('stat-connected-clients').textContent = data.stats.connectedClients;
                lastUpdateEl.textContent = new Date(data.stats.lastUpdate).toLocaleTimeString('es-MX');
            }
            
            // Mostrar animaciÃ³n de actualizaciÃ³n
            const statsContainer = document.querySelector('.quick-stats');
            statsContainer.style.animation = 'pulse 0.5s ease-in-out';
            setTimeout(() => {
                statsContainer.style.animation = '';
            }, 500);
        });
        
        // Actualizar estadÃ­sticas generales
        ws.on('stats:update', (stats) => {
            document.getElementById('stat-total-attendance').textContent = stats.totalAttendance;
            document.getElementById('stat-active-events').textContent = stats.activeEvents;
            document.getElementById('stat-connected-clients').textContent = stats.connectedClients;
            lastUpdateEl.textContent = new Date(stats.lastUpdate).toLocaleTimeString('es-MX');
        });
        
        // Solicitar estadÃ­sticas al unirse
        ws.on('joined:admin', (data) => {
            console.log('âœ… Unido a sala de admin');
            if (data.stats) {
                ws.trigger('stats:update', data.stats);
            }
        });
    </script>
    
    <!-- Session guard DESHABILITADO - usando solo sesiÃ³n PHP -->
    <!-- <script src="../js/session-guard.js"></script> -->
    
    <script>
        // Logout mejorado
        const logoutBtn = document.getElementById('logout-btn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', (e) => {
                e.preventDefault();
                if (window.sessionGuard && typeof window.sessionGuard.logout === 'function') {
                    window.sessionGuard.logout();
                } else {
                    window.location.href = 'login_admin.html';
                }
            });
        }
    </script>
    
    <style>
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
    </style>
</body>
</html>